<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Reborn: Hyper Tunnel</title>
    <style>
        :root { --neon: #00f3ff; --bg: #020205; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Orbitron', sans-serif; touch-action: none; }
        canvas { display: block; filter: contrast(120%) brightness(110%); }
        
        #hud { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0, 0, 0, 0.8); padding: 10px 20px; border: 1px solid var(--neon); color: var(--neon); border-radius: 5px; box-shadow: 0 0 15px var(--neon); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; color: white; }
        button { padding: 18px 70px; font-size: 24px; background: var(--neon); border: none; color: black; font-weight: bold; border-radius: 5px; cursor: pointer; margin-top: 30px; box-shadow: 0 0 30px var(--neon); text-transform: uppercase; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat">VELOCITY: <span id="speed">0</span></div>
    <div class="stat">RC: <span id="rc">0</span></div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="color: var(--neon); font-size: 50px; margin:0; letter-spacing: 5px;">R-REBORN</h1>
    <p>THE TUNNEL IS INFINITE. THE MUSIC IS ETERNAL.</p>
    <p>Drag Left/Right to avoid the energy walls!</p>
    <button onclick="initGame()">ENTER HYPERSPACE</button>
</div>

<canvas id="tunnelCanvas"></canvas>

<script>
    const canvas = document.getElementById('tunnelCanvas');
    const ctx = canvas.getContext('2d');
    let gameActive = false, rc = 0, velocity = 100;
    let playerX = 0, targetX = 0;
    let particles = [], obstacles = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- CONTINUOUS INDUSTRIAL TECHNO ENGINE ---
    function startMusic() {
        if (!gameActive) return;
        const now = audioCtx.currentTime;

        // Heavy Bass Kick
        const kick = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        kick.frequency.setValueAtTime(60, now);
        kick.frequency.exponentialRampToValueAtTime(0.01, now + 0.4);
        g.gain.setValueAtTime(0.4, now);
        g.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
        kick.connect(g); g.connect(audioCtx.destination);
        kick.start(); kick.stop(now + 0.4);

        // Synth Lead Loop
        const synth = audioCtx.createOscillator();
        const sg = audioCtx.createGain();
        synth.type = 'sawtooth';
        synth.frequency.setValueAtTime(110 + (velocity/5), now);
        sg.gain.setValueAtTime(0.02, now);
        sg.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
        synth.connect(sg); sg.connect(audioCtx.destination);
        synth.start(); synth.stop(now + 0.2);

        setTimeout(startMusic, 250); // Fast 140 BPM rhythm
    }

    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        gameActive = true;
        if(audioCtx.state === 'suspended') audioCtx.resume();
        startMusic();
        spawnObstacle();
        update();
    }

    window.onpointermove = (e) => {
        targetX = (e.clientX - canvas.width / 2) / (canvas.width / 2);
    };

    function spawnObstacle() {
        if(!gameActive) return;
        obstacles.push({
            z: 1000,
            x: (Math.random() - 0.5) * 2,
            w: 0.8,
            h: 0.8,
            color: Math.random() > 0.5 ? '#00f3ff' : '#ff00ff'
        });
        setTimeout(spawnObstacle, Math.max(100, 500 - velocity/2));
    }

    function update() {
        if(!gameActive) return;
        ctx.fillStyle = '#020205';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const cx = canvas.width / 2;
        const cy = canvas.height / 2;

        playerX += (targetX - playerX) * 0.15;
        velocity += 0.1;
        document.getElementById('speed').innerText = Math.floor(velocity);

        // Render Tunnel Perspective
        for(let i = 0; i < 10; i++) {
            ctx.strokeStyle = `rgba(0, 243, 255, ${0.1 * i})`;
            ctx.strokeRect(cx - (50 * i) - (playerX * 50), cy - (50 * i), 100 * i, 100 * i);
        }

        // Handle Obstacles
        obstacles.forEach((ob, i) => {
            ob.z -= velocity / 10;
            const size = 1000 / ob.z;
            const screenX = cx + (ob.x - playerX) * size * 200;
            const screenY = cy;
            const sw = ob.w * size * 100;
            const sh = ob.h * size * 100;

            if(ob.z > 50) {
                ctx.fillStyle = ob.color;
                ctx.shadowBlur = 20; ctx.shadowColor = ob.color;
                ctx.fillRect(screenX - sw/2, screenY - sh/2, sw, sh);
                ctx.shadowBlur = 0;
            } else if(ob.z <= 50 && ob.z > 0) {
                // Collision Detection
                if(Math.abs(ob.x - playerX) < 0.4) {
                    gameOver();
                }
            }
            if(ob.z <= 0) {
                obstacles.splice(i, 1);
                rc += 10;
                document.getElementById('rc').innerText = rc;
            }
        });

        requestAnimationFrame(update);
    }

    function gameOver() {
        gameActive = false;
        alert("REBORN NECESSARY. Final Velocity: " + Math.floor(velocity));
        location.reload();
    }
</script>
</body>
</html>