<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Reborn: Balanced</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Segoe UI', sans-serif; }
        #ui { position: absolute; top: 20px; color: #fff; font-size: 22px; text-shadow: 0 0 10px #0ff; pointer-events: none; z-index: 10; letter-spacing: 2px; }
        canvas { background: #000; cursor: crosshair; }
    </style>
</head>
<body>
    <div id="ui">REBORN ENERGY: <span id="score">0</span></div>
    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = 0, gameActive = true, musicStarted = false;
    // Player configuration
    let player = { x: canvas.width/2, y: canvas.height/2, r: 12, targetX: canvas.width/2, targetY: canvas.height/2 };
    let enemies = [];

    // Ambient Synth Music
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTranceMusic() {
        if (musicStarted) return; musicStarted = true;
        setInterval(() => {
            if(!gameActive) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine'; // Yumshoqroq ovoz uchun sine ishlatildi
            const notes = [196, 220, 261, 329]; 
            osc.frequency.setValueAtTime(notes[Math.floor(Date.now()/1000)%4], audioCtx.currentTime);
            gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.8);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.8);
        }, 1000);
    }

    window.addEventListener("pointerdown", (e) => {
        playTranceMusic();
        player.targetX = e.clientX;
        player.targetY = e.clientY;
    });

    function spawnEnemy() {
        // Ehtimollik 0.02 ga tushirildi (kamroq dushman chiqadi)
        if (Math.random() < 0.02) {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            if(side === 0) { x = Math.random()*canvas.width; y = -30; }
            else if(side === 1) { x = canvas.width+30; y = Math.random()*canvas.height; }
            else if(side === 2) { x = Math.random()*canvas.width; y = canvas.height+30; }
            else { x = -30; y = Math.random()*canvas.height; }

            const angle = Math.atan2(player.y - y, player.x - x);
            // Tezlik 2 ga tushirildi (sekinroq harakat)
            enemies.push({ x, y, vx: Math.cos(angle) * 2, vy: Math.sin(angle) * 2 });
        }
    }

    function update() {
        if (!gameActive) return;

        // Sekinroq va silliqroq harakat (0.08)
        player.x += (player.targetX - player.x) * 0.08;
        player.y += (player.targetY - player.y) * 0.08;

        enemies.forEach((en, i) => {
            en.x += en.vx;
            en.y += en.vy;

            const dist = Math.sqrt((player.x - en.x)**2 + (player.y - en.y)**2);
            if (dist < player.r + 6) {
                gameOver();
            }

            if (en.x < -100 || en.x > canvas.width+100 || en.y < -100 || en.y > canvas.height+100) {
                enemies.splice(i, 1);
                score += 10;
                scoreEl.innerText = score;
            }
        });
    }

    function draw() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.25)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Player
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#0ff";
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
        ctx.fill();

        // Enemies (Qizil/Pushti nurlar)
        ctx.shadowColor = "#f0f";
        ctx.fillStyle = "#f0f";
        enemies.forEach(en => {
            ctx.beginPath();
            ctx.arc(en.x, en.y, 6, 0, Math.PI*2);
            ctx.fill();
        });

        ctx.shadowBlur = 0;
        update();
        spawnEnemy();
        requestAnimationFrame(draw);
    }

    function gameOver() {
        gameActive = false;
        alert("REBIRTH NEEDED! Energy: " + score);
        location.reload();
    }

    draw();
</script>
</body>
</html>